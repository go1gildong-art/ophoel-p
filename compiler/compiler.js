import { tokenize } from './lexer.js';
import { parse } from './parser.js';
import { transform } from "./transformer.js"
import { generate } from "./generator.js"
// Load Configs
// const config = JSON.parse(fs.readFileSync('./configs.json', 'utf8'));




let code =
`
say!!(\`help \${-1 * 2} aaa\`);
`;

export function compile(sourceCode, config, fileName) {
    // 1. Raw text to Tokens
    let tokens = tokenize(sourceCode, config, fileName);

    // 2. parse tokens to get string mcfunction output
    let ast = parse(tokens);

    // 3. flatten and solve all compile time computations
    let processedAst = transform(ast, config);

    // 4. generate mcfunction from processed ast
    let commands = generate(processedAst);

    return ["## This mcfunction is generated by Ophoel compiler.", ...commands].join("\n");
}

console.log(tokenize(code, {}, "source.oph"));
console.log(JSON.stringify(parse(tokenize(code, {}, "source.oph"))));
// console.log(JSON.stringify(transform(parse(tokenize(code, {}, "source.oph"))), { brrr: 10 }));
console.log(compile(code, {brrr: 40}, "source.oph"));