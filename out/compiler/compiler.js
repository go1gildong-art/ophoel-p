"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.compile = compile;
const lexer_js_1 = require("./lexer.js");
const parser_js_1 = require("./parser.js");
const transformer_js_1 = require("./transformer.js");
const irgen_js_1 = require("./irgen.js");
const generator_js_1 = require("./generator.js");
const lispifyast_js_1 = require("./lispifyast.js");
// Load Configs
// const config = JSON.parse(fs.readFileSync('./configs.json', 'utf8'));
const code = `

mc_exec(\`as @e[tag=\${config.room_anchor_tag}, tag=\${config.room_s.tag}]\`) {
  let mut x: int_c = config.room_s.radius;
  let mut y: int_c = config.room_s.radius;
  /.
  let mut ii = 0;
  // iterator
  repeat(config.room_types.length) {
    let room_type = config.room_types[ii];
    mc_exec(\`if entity @s[tag=\${config.room_tags.type[room_type]}]\`) {
      repeat(4) {
        setblock!!(\`~\${x} ~ ~\${y} \${config.corridor_lamps.type[room_type]}\`);
        let temp = x;
        x = y * -1;
        y = temp;
      }
      /.
      ii += 1;

    }
  }
}

`;
const config = { my_arr: [1, 2, 3], room_anchor_tag: "room_anchor", room_s: { radius: 7, tag: "room_s" } };
function compile(sourceCode, config, fileName) {
    // 1. Raw text to Tokens
    let tokens = (0, lexer_js_1.tokenize)(sourceCode, config, fileName);
    // 2. parse tokens to get string mcfunction output
    let ast = (0, parser_js_1.parse)(tokens);
    // 3. flatten and solve all compile time computations
    let processedAst = (0, transformer_js_1.transform)(ast, config);
    // 4. get lower ast to make ir
    let ir = (0, irgen_js_1.makeIr)(processedAst);
    // 4. generate mcfunction from processed ast
    let commands = (0, generator_js_1.generate)(ir);
    return ["## This mcfunction is generated by Ophoel compiler.", ...commands].join("\n");
}
// console.log("");
// console.log(tokenize(code, config, "source.oph"));
// console.log(JSON.stringify(parse(tokenize(code, config, "source.oph"))) + "\n");
// console.log(JSON.stringify(transform(parse(tokenize(code, config, "source.oph")), config)) + "\n");
// console.log(JSON.stringify(makeIr(transform(parse(tokenize(code, config, "source.oph")), config))) + "\n");
// console.log(compile(code, config, "source.oph") + "\n\n");
console.log((0, lispifyast_js_1.lispify)((0, parser_js_1.parse)((0, lexer_js_1.tokenize)(code, config, "source.oph"))) + "\n");
//# sourceMappingURL=compiler.js.map